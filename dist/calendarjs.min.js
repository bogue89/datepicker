if(void 0===JBTools)var JBTools={hasClass:function(t,e){return!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},addClass:function(t,e){JBTools.hasClass(t,e)||(t.className+=" "+e)},removeClass:function(t,e){if(JBTools.hasClass(t,e)){var o=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(o," ").trim()}},ucfirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},each:function(t,e){for(var o=0;o<t.length;o++)e(t[o],o)},replaceIfMatched:function(t,e,o){return t.match(e)&&(t="string"==typeof o?t.replace(e,o):t.replace(e,o())),t},create:function(t){var e=document.createElement("div");return e.innerHTML=t.trim(),e.childNodes.length>1?e.childNodes:e.firstChild},insert:function(t,e,o){return e.childNodes.length>0&&o<e.childNodes.length&&"bottom"!==o?("top"===o&&(o=0),e.insertBefore(t,e.childNodes[o])):e.appendChild(t),t},before:function(t,e){var o=e.parentNode,n=Array.prototype.indexOf.call(o.childNodes,e)-1;return JBTools.insert(t,o,n>0?n:0)},after:function(t,e){var o=e.parentNode,n=Array.prototype.indexOf.call(o.childNodes,e)+1;return JBTools.insert(t,o,n)},remove:function(t){var e=t.parentNode;e&&e.removeChild(t)},contains:function(t,e){return t==e||!(!e||!JBTools.contains(t,e.parentNode))},strip:function(t){var e=document.createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText||""},dateFormatOption:function(t,e,o,n){var s={};s[e]=o,"weekday"!=e&&"year"!=e&&"month"!=e&&"day"!=e&&(s.year="numeric"),"hour"==e&&"numeric"==o?s.hour12=!0:"hour12"==e?(s.hour="numeric",s.hour12=!0):s.hour12=!1;var a=t.toLocaleDateString(n||"es-ES",s);if("weekday"==e||"month"==e)a=JBTools.ucfirst(a);else if("hour"==e||"minute"==e||"second"==e)a=("0"+a.split(" ")[1]).slice(-2);else if("hour12"==e){var r=a.split(" "),i=r[2]+r[3];a="lower"==o?i.toLowerCase():i.toUpperCase()}else"timeZoneName"==e&&(a=a.slice(5));return a},dateFormat:function(t,e,o){return e||(e="%Y-%m-%d"),e=JBTools.replaceIfMatched(e,/\%j/g,function(){return t.getDate()}),e=JBTools.replaceIfMatched(e,/\%d/g,function(){return("0"+t.getDate()).slice(-2)}),e=JBTools.replaceIfMatched(e,/\%D/g,function(){return JBTools.dateFormatOption(t,"weekday","narrow",o)}),e=JBTools.replaceIfMatched(e,/\%l/g,function(){return JBTools.dateFormatOption(t,"weekday","short",o)}),e=JBTools.replaceIfMatched(e,/\%L/g,function(){return JBTools.dateFormatOption(t,"weekday","long",o)}),e=JBTools.replaceIfMatched(e,/\%n/g,function(){return t.getMonth()+1}),e=JBTools.replaceIfMatched(e,/\%m/g,function(){return("0"+(t.getMonth()+1)).slice(-2)}),e=JBTools.replaceIfMatched(e,/\%f/g,function(){return JBTools.dateFormatOption(t,"month","narrow",o)}),e=JBTools.replaceIfMatched(e,/\%M/g,function(){return JBTools.dateFormatOption(t,"month","short",o)}),e=JBTools.replaceIfMatched(e,/\%F/g,function(){return JBTools.dateFormatOption(t,"month","long",o)}),e=JBTools.replaceIfMatched(e,/\%Y/g,function(){return t.getFullYear()}),e=JBTools.replaceIfMatched(e,/\%y/g,function(){return("0"+t.getFullYear()).slice(-2)}),e=JBTools.replaceIfMatched(e,/\%h/g,function(){return JBTools.dateFormatOption(t,"hour","numeric",o)}),e=JBTools.replaceIfMatched(e,/\%H/g,function(){return JBTools.dateFormatOption(t,"hour","2-digit",o)}),e=JBTools.replaceIfMatched(e,/\%i/g,function(){return("0"+t.getMinutes()).slice(-2)}),e=JBTools.replaceIfMatched(e,/\%s/g,function(){return("0"+t.getSeconds()).slice(-2)}),e=JBTools.replaceIfMatched(e,/\%a/g,function(){return JBTools.dateFormatOption(t,"hour12","lower",o)}),e=JBTools.replaceIfMatched(e,/\%A/g,function(){return JBTools.dateFormatOption(t,"hour12","upper",o)}),e=JBTools.replaceIfMatched(e,/\%t/g,function(){return JBTools.dateFormatOption(t,"timeZoneName","short",o)}),e=JBTools.replaceIfMatched(e,/\%T/g,function(){return JBTools.dateFormatOption(t,"timeZoneName","long",o)})}};if(void 0===DatePickerJS){var DatePickerJS=function(t,e={}){this.input=t,this.body=document.querySelector("body");var o=Date.parse(t.value);this.date=e.date=isNaN(o)?new Date:new Date(o),e.events||(e.events={}),e.events.onDay=this.onDay.bind(this),e.events.loaded=this.loaded.bind(this),e.type="month",e.time=e.time||!1,this.calendar=new CalendarJS(null,e),this.container=document.createElement("div"),this.container.setAttribute("class","datepicker-container"),this.container.setAttribute("tabindex","-1"),JBTools.insert(this.calendar.container,this.container),e.time&&(e.events=Object.assign({},e.events),e.events.title=function(t,e){return""},e.events.onControl=this.onTime.bind(this),e.type="clock",this.clock=new CalendarJS(null,e),JBTools.insert(this.clock.container,this.container)),this.options=e,this.behaviour()};DatePickerJS.prototype.loaded=function(t,e){var o=this.date.getFullYear(),n=this.date.getMonth()+1,s=this.date.getDate(),a=t.domElement.querySelector('.day[year="'+o+'"][month="'+n+'"][day="'+s+'"]');a&&JBTools.addClass(a,"selected")},DatePickerJS.prototype.onTime=function(t,e){var o=[];JBTools.each(t.domElement.querySelectorAll(".clock-rows input"),function(t){o.push(t.value)}),self.date=new Date(self.date.getFullYear(),self.date.getMonth(),self.date.getDate(),o[0],o[1],o[2]||0),self.input.value=t.format(self.date,t.options.format),self.blur()},DatePickerJS.prototype.onDay=function(t,e){self=this,self.date=new Date(e.getAttribute("year"),e.getAttribute("month")-1,e.getAttribute("day")),JBTools.each(t.domElement.querySelectorAll(".day.selected"),function(t){JBTools.removeClass(t,"selected")}),JBTools.addClass(e,"selected"),self.options.time||(self.input.value=t.format(self.date,t.options.format),self.blur())},DatePickerJS.prototype.focus=function(){self=this,clearTimeout(self.timeout),setTimeout(function(){clearTimeout(self.timeout)},10)},DatePickerJS.prototype.blur=function(t){self=this,JBTools.removeClass(self.container,"focus"),self.body.removeEventListener("click",self.clickOnBody,!1),self.body.removeEventListener("keydown",self.keyOnBody,!1),self.input.blur(),self.timeout2=setTimeout(function(){JBTools.addClass(self.container,"hidden")},self.options.hidden||200)},DatePickerJS.prototype.inputFocus=function(){self=this,clearTimeout(self.timeout2),JBTools.removeClass(self.container,"hidden"),JBTools.addClass(self.container,"focus"),setTimeout(function(){self.body.addEventListener("click",self.clickOnBody,!1),self.body.addEventListener("keydown",self.keyOnBody,!1)},100)},DatePickerJS.prototype.inputBlur=function(){self=this,clearTimeout(self.timeout),self.timeout=setTimeout(self.blur,20)},DatePickerJS.prototype.keyOnBody=function(t){self=this,"Escape"==t.key&&self.inputBlur()},DatePickerJS.prototype.clickOnBody=function(t){self=this,t.target==self.input||JBTools.contains(self.container,t.target)||self.inputBlur()},DatePickerJS.prototype.behaviour=function(){var t=this;JBTools.addClass(t.container,"hidden"),JBTools.after(t.container,t.input),t.keyOnBody=t.keyOnBody.bind(t),t.clickOnBody=t.clickOnBody.bind(t),t.inputFocus=t.inputFocus.bind(t),t.inputBlur=t.inputBlur.bind(t),t.focus=t.focus.bind(t),t.blur=t.blur.bind(t),t.input.addEventListener("focus",t.inputFocus,!0),t.input.addEventListener("blur",t.inputBlur,!0),t.container.addEventListener("focus",t.focus,!1),t.container.addEventListener("click",t.focus,!1),JBTools.each(t.container.querySelectorAll("button, input"),function(e,o){e.addEventListener("focus",t.focus,!1),e.addEventListener("blur",t.inputBlur,!1)})}}if(void 0===CalendarJS){var CalendarJS=function(t,e={}){this.container=null,this.domElement=null,this.options={debug:e.debug||!1,date:e.date||new Date,format:e.format||"%Y-%m-%d %H:%i:%s",lang:e.lang||"es-Es",type:e.type||"month",containerClass:e.containerClass||"calendarjs-container",controlsClass:e.controlsClass||"calendarjs-control",events:e.events||{},startsOnMonday:e.startsOnMonday||!0,weekend:e.weekend,starts:this.clock2Time(e.starts),ends:this.clock2Time(e.ends),timespan:this.clock2Time(e.timespan),timespanIndicatos:e.timespanIndicatos||!0,hour12:!0===e.hour12,seconds:!0===e.seconds},this.timeMarks=[{time:604800,suffix:"w"},{time:86400,suffix:"d"},{time:3600,suffix:"h"},{time:60,suffix:"m"},{time:1,suffix:"s"}],t?this.container="string"==typeof t?document.querySelector(t):t:(this.container=document.createElement("div"),this.container.setAttribute("class",this.options.containerClass)),this.setDate(this.options.date)};CalendarJS.prototype.format=function(t,e){return JBTools.dateFormat(t,e,this.options.lang)},CalendarJS.prototype.event=function(t,e,o){return this.options.events[t]?this.options.events[t].apply(t,e):o.apply(t,e)},CalendarJS.prototype.time2Human=function(t){t=parseInt(t)||0;var e="";return JBTools.each(this.timeMarks,function(o,n){var s=Math.floor(t/o.time);t%=o.time,(s>0||"s"==o.suffix&&""==e)&&(e+=" "+s+o.suffix)}),e.trim()},CalendarJS.prototype.time2Clock=function(t,e=!0){t=parseInt(t)||0;var o=[];return JBTools.each([3600,60],function(e,n){var s=Math.floor(t/e);t%=e,o.push(("0"+s).slice(-2))}),e&&o.push(("0"+t).slice(-2)),o.join(":")},CalendarJS.prototype.human2Time=function(t){var e=0;return JBTools.each(this.timeMarks,function(o,n){var s=new RegExp("(\\d+)"+o.suffix,"i").exec(t);s&&(e+=parseInt(s[1]*o.time)||0)}),e},CalendarJS.prototype.clock2Time=function(t,e=!0){var o=0;if("string"==typeof t){o=0;var n=t.split(":"),s=[3600,60,1];JBTools.each(n,function(t,e){s[e]&&(o+=t*s[e])})}else o=parseInt(t)||0;return o},CalendarJS.prototype.doubleDigits=function(t,e,o){t.addEventListener("focus",function(){this.select?this.select():this.setSelectionRange&&this.setSelectionRange(0,this.value.length)},!1),t.addEventListener("change",function(){this.value=parseInt(this.value)||0,this.value=this.value<0?0:this.value,this.value=this.value>e?e:this.value,this.value=("0"+this.value).slice(-2),o()},!1),t.addEventListener("keydown",function(e){if("Enter"==e.key)if(e.preventDefault(),o(),"createEvent"in document){var n=document.createEvent("HTMLEvents");n.initEvent("change",!1,!0),t.dispatchEvent(n)}else t.fireEvent("onchange")},!1)},CalendarJS.prototype.setDate=function(t){if(this.options.date=new Date(t),this.options.debug)var e=performance.now();if("clock"==this.options.type?this.Clock(t):"day"==this.options.type?this.Day(t):"week"==this.options.type?this.Week(t):"month"==this.options.type&&this.Month(t),this.options.debug){var o=performance.now();console.log(o-e)}this.event("loaded",[this,this.options],function(t,e){})}}void 0!==CalendarJS&&void 0===CalendarJS.Month&&(CalendarJS.prototype.Month=function(t){const e=this,o=new Date(t),n=e.format(new Date,"%Y-%n-%j");var s=!0===e.options.startsOnMonday?0==t.getDay()?-6:1:0,a=0===e.options.weekend?0:1===e.options.weekend?1:2,r=e.event("title",[e,t],function(t,o){return e.format(o,"%F")}),i="<tr><th>"+e.event("controlLeft",[e,t],function(t,o){return'<button type="button" class="control-left '+e.options.controlsClass+'">«</button>'})+'</th><th class="title" colspan="'+(3+a)+'">'+r+"</th><th>"+e.event("controlRight",[e,t],function(t,o){return'<button type="button" class="control-right '+e.options.controlsClass+'">»</button>'})+"</th></tr>",l="";o.setDate(1);var c=o.getDay(),d=o.getTime(),u=[];l+="<tr>";for(var f=0;f<7;f++){if(!(f==(0===s?0:6)&&a<2)&&!(f==(0===s?6:5)&&a<1)){var p=f-c+s,h=d+864e5*p;o.setTime(h),u.push(o.getDate()),l+='<th class="day'+(0===p?" today":"")+'">'+e.event("day",[e,o],function(t,o){return e.format(o,"%l")})+"</th>"}}l+="</tr>";var m=u[f=u.length-1]>15?0==c?2:3:0,v=t.getMonth()+1,y=t.getFullYear();o.setMonth(v),o.setDate(0);for(var J,g=o.getDate(),T=u[u.length-1],B=0;m<g;){l+="<tr>";for(f=0;f<u.length;f++){var b=u[f],k=m>0?m:b;if(m<1&&k>15){var C=y;(D=v-1)<1&&(D=12,C-=1),l+='<td class="day" day="'+k+'" month="'+D+'" year="'+C+'">'+e.event("day",[e,C,D,k,!1],function(t,e,o,n,s){return""})+"</td>"}else if(k<=g){l+='<td class="day'+(n==y+"-"+v+"-"+k?" today":"")+'" current day="'+k+'" month="'+v+'" year="'+y+'">'+e.event("day",[e,y,v,k,!0],function(t,e,o,n,s){return n})+"</td>"}else{var D;C=y;(D=v+1)>12&&(D=1,C+=1),l+='<td class="day" day="'+(k-=g)+'" month="'+D+'" year="'+C+'">'+e.event("day",[e,C,D,k,!1],function(t,e,o,n){return""})+"</td>"}m>0&&(m+=1)}if(l+="</tr>",m<1&&(m=T+1),m+=2-a,(B+=1)>300)break}e.domElement=JBTools.create('<table class="calendar-js calendar-'+e.options.type+'-js"><thead>'+i+"<thead><tbody>"+l+"</tbody></table>"),e.container.innerHTML="",JBTools.insert(e.domElement,e.container),JBTools.each(e.domElement.querySelectorAll("td.day"),function(t,o){t.addEventListener("click",function(o){e.event("onDay",[e,t],function(t,e){JBTools.hasClass(e,"selected")?JBTools.removeClass(e,"selected"):JBTools.addClass(e,"selected")})},!1)}),(J=e.domElement.querySelector(".control-left"))&&J.addEventListener("click",function(t){e.event("onControlLeft",[e,J],function(t,e){t.options.date.setMonth(t.options.date.getMonth()-1),t.setDate(t.options.date)})},!1),(J=e.domElement.querySelector(".control-right"))&&J.addEventListener("click",function(t){e.event("onControlRight",[e,J],function(t,e){t.options.date.setMonth(t.options.date.getMonth()+1),t.setDate(t.options.date)})},!1)}),void 0!==CalendarJS&&void 0===CalendarJS.Week&&(CalendarJS.prototype.Week=function(t){const e=this,o=new Date(t),n=e.format(new Date,"%Y-%m-%d");var s=!0===e.options.startsOnMonday?0==t.getDay()?-6:1:0,a=0===e.options.weekend?0:1===e.options.weekend?1:2,r=!0===e.options.timespanIndicatos,i=e.event("title",[e,o],function(t,o){return e.format(o,"%F")}),l="<tr>"+(r?"<th></th>":"")+"<th>"+e.event("controlLeft",[e,o],function(t,o){return'<button type="button" class="control-left '+e.options.controlsClass+'">«</button>'})+'</th><th class="title" colspan="'+(3+a)+'">'+i+"</th><th>"+e.event("controlRight",[e,o],function(t,o){return'<button type="button" class="control-right '+e.options.controlsClass+'">»</button>'})+"</th></tr>",c="",d=t.getDay(),u=t.getTime(),f=[];c+="<tr>",r&&(c+="<th></th>");for(var p=0;p<7;p++){if(!(p==(0===s?0:6)&&a<2)&&!(p==(0===s?6:5)&&a<1)){var h=p-d+s,m=u+864e5*h;o.setTime(m),f.push(e.format(o,"%Y-%m-%d")),c+='<th class="day'+(0===h?" today":"")+'">'+e.event("day",[e,o],function(t,o){return e.format(o,"%l %d")})+"</th>"}}c+="</tr>";for(var v,y=e.options.starts||0,J=e.options.ends||86400,g=e.options.timespan||3600;y<J;){if(c+="<tr>",r)c+='<td class="indicator">'+e.event("indicator",[e,y,y+g],function(t,o,n){return e.time2Human(o)})+"</td>";for(p=0;p<f.length;p++){var T=e.event("timespan",[e,f[p],y,y+g],function(t,e,o,n){return e}),B=f[p];c+='<td class="timespan'+(B==n?" today":"")+'" date="'+B+'" starts="'+y+'" ends="'+(y+g)+'">'+T+"</td>"}c+="</tr>",y+=g}e.domElement=JBTools.create('<table class="calendar-js calendar-'+e.options.type+'-js"><thead>'+l+"<thead><tbody>"+c+"</tbody></table>"),e.container.innerHTML="",JBTools.insert(e.domElement,e.container),(v=e.domElement.querySelector(".control-left"))&&v.addEventListener("click",function(t){e.event("onControlLeft",[e,v],function(t,e){t.options.date.setDate(t.options.date.getDate()-7),t.setDate(t.options.date)})},!1),(v=e.domElement.querySelector(".control-right"))&&v.addEventListener("click",function(t){e.event("onControlRight",[e,v],function(t,e){t.options.date.setDate(t.options.date.getDate()+7),t.setDate(t.options.date)})},!1)}),void 0!==CalendarJS&&void 0===CalendarJS.Day&&(CalendarJS.prototype.Day=function(t){const e=this,o=new Date(t),n=e.format(new Date,"%Y-%m-%d");for(var s,a=!0===e.options.timespanIndicatos,r=e.event("title",[e,o],(t,o)=>e.format(o,"%l %d")),i="<tr>"+(a?"<th></th>":"")+"<th>"+e.event("controlLeft",[e,o],(t,o)=>'<button type="button" class="control-left '+e.options.controlsClass+'">&lt;</button>')+'</th><th class="title">'+r+"</th><th>"+e.event("controlRight",[e,o],(t,o)=>'<button type="button" class="control-right '+e.options.controlsClass+'">&gt;</button>')+"</th></tr>",l="",c=e.format(o,"%Y-%m-%d"),d=(t.getTime(),e.options.starts||0),u=e.options.ends||86400,f=e.options.timespan||3600;d<u;){if(l+="<tr>",a)l+='<td class="indicator">'+e.event("indicator",[e,d,d+f],(t,o,n)=>e.time2Human(o))+"</td>";l+='<td colspan="3" class="timespan'+(c==n?" today":"")+'" date="'+c+'" starts="'+d+'" ends="'+(d+f)+'">'+e.event("timespan",[e,c,d,d+f],(t,e,o,n)=>e)+"</td>",l+="</tr>",d+=f}e.domElement=JBTools.create('<table class="calendar-js calendar-'+e.options.type+'-js"><thead>'+i+"<thead><tbody>"+l+"</tbody></table>"),e.container.innerHTML="",JBTools.insert(e.domElement,e.container),(s=e.domElement.querySelector(".control-left"))&&s.addEventListener("click",t=>{e.event("onControlLeft",[e,s],(t,e)=>{t.options.date.setDate(t.options.date.getDate()-1),t.setDate(t.options.date)})},!1),(s=e.domElement.querySelector(".control-right"))&&s.addEventListener("click",t=>{e.event("onControlRight",[e,s],(t,e)=>{t.options.date.setDate(t.options.date.getDate()+1),t.setDate(t.options.date)})},!1)}),void 0!==CalendarJS&&void 0===CalendarJS.Clock&&(CalendarJS.prototype.Clock=function(t){const e=this,o=new Date(t);e.options.hour12;var n=e.options.seconds,s='<th class="title" colspan="5">'+e.event("title",[e,o],function(t,o){return e.format(o,"%l %d")})+"</th>",a="";a+='<tr class="clock-rows">',n?(a+='<td class="hours"><input size="2" value="'+e.format(o,"%H")+'"></td>',a+="<td>:</td>",a+='<td class="minutes"><input size="2" value="'+e.format(o,"%i")+'"></td>',a+="<td>:</td>",a+='<td class="seconds"><input size="2" value="'+e.format(o,"%s")+'"></td>'):(a+='<td class="hours" colspan="2"><input size="2" value="'+e.format(o,"%H")+'"></td>',a+="<td>:</td>",a+='<td class="minutes" colspan="2"><input size="2" value="'+e.format(o,"%i")+'"></td>'),a+="</tr>";var r=e.event("control",[e,o],function(t,o){return'<button type="button" class="control '+e.options.controlsClass+'">OK</button>'});r>""&&(a+="<tr>",a+='<td colspan="5">'+r+"</td>",a+="</tr>"),e.container.innerHTML="",e.domElement=JBTools.insert(JBTools.create('<table class="calendar-js calendar-'+e.options.type+'-js"><thead>'+s+"<thead><tbody>"+a+"</tbody></table>"),e.container);var i,l=e.domElement.querySelectorAll(".clock-rows input");JBTools.each(l,function(t,n){e.doubleDigits(t,0==n?23:59,function(){JBTools.each(l,function(t,e){0==e?o.setHours(parseInt(t.value)):1==e?o.setMinutes(parseInt(t.value)):2==e&&o.setSeconds(parseInt(t.value))}),e.event("onChange",[e,o],function(t,e){})})}),(i=e.domElement.querySelector(".control"))&&i.addEventListener("click",function(t){return e.event("onControl",[e,i],function(t,e){return!1})},!1)});