var JBTools={};JBTools.initialize=function(t,e){return t.options=e||{},t.events=t.options.events||{},t.JBEvent=function(e,o,n){return t.events[e]?t.events[e].apply(e,o):n.apply(e,o)},t},JBTools.hasClass=function(t,e){return!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},JBTools.addClass=function(t,e){JBTools.hasClass(t,e)||(t.className+=" "+e)},JBTools.removeClass=function(t,e){if(JBTools.hasClass(t,e)){var o=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(o," ").trim()}},JBTools.ucfirst=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},JBTools.each=function(t,e){for(var o=0;o<t.length;o++)e(t[o],o)},JBTools.replaceIfMatched=function(t,e,o){return t.match(e)&&(t="string"==typeof o?t.replace(e,o):t.replace(e,o())),t},JBTools.create=function(t){var e=document.createDocumentFragment(),o=document.createElement("div");for(o.innerHTML=t;o.firstChild;)e.appendChild(o.firstChild);return e},JBTools.insert=function(t,e){return e!=t.parentNode&&(e.childNodes.length?e.insertBefore(t,e.childNodes[e.childNodes.length-1].nextSibling):e.insertBefore(t,e.childNodes[0])),e.childNodes[0]},JBTools.remove=function(t){var e=t.parentNode;e&&e.removeChild(t)},JBTools.dateFormatOption=function(t,e,o,n){var a={};a[e]=o,"weekday"!=e&&"year"!=e&&"month"!=e&&"day"!=e&&(a.year="numeric"),"hour"==e&&"numeric"==o?a.hour12=!0:"hour12"==e?(a.hour="numeric",a.hour12=!0):a.hour12=!1;var r=t.toLocaleDateString(n||"es-ES",a);if("weekday"==e||"month"==e)r=JBTools.ucfirst(r);else if("hour"==e||"minute"==e||"second"==e)r=("0"+r.split(" ")[1]).slice(-2);else if("hour12"==e){var s=r.split(" "),i=s[2]+s[3];r="lower"==o?i.toLowerCase():i.toUpperCase()}else"timeZoneName"==e&&(r=r.slice(5));return r},JBTools.dateFormat=function(t,e,o){return e||(e="%Y-%m-%d"),e=JBTools.replaceIfMatched(e,/\%j/g,function(){return JBTools.dateFormatOption(t,"day","numeric",o)}),e=JBTools.replaceIfMatched(e,/\%d/g,function(){return JBTools.dateFormatOption(t,"day","2-digit",o)}),e=JBTools.replaceIfMatched(e,/\%D/g,function(){return JBTools.dateFormatOption(t,"weekday","narrow",o)}),e=JBTools.replaceIfMatched(e,/\%l/g,function(){return JBTools.dateFormatOption(t,"weekday","short",o)}),e=JBTools.replaceIfMatched(e,/\%L/g,function(){return JBTools.dateFormatOption(t,"weekday","long",o)}),e=JBTools.replaceIfMatched(e,/\%n/g,function(){return JBTools.dateFormatOption(t,"month","numeric",o)}),e=JBTools.replaceIfMatched(e,/\%m/g,function(){return JBTools.dateFormatOption(t,"month","2-digit",o)}),e=JBTools.replaceIfMatched(e,/\%f/g,function(){return JBTools.dateFormatOption(t,"month","narrow",o)}),e=JBTools.replaceIfMatched(e,/\%M/g,function(){return JBTools.dateFormatOption(t,"month","short",o)}),e=JBTools.replaceIfMatched(e,/\%F/g,function(){return JBTools.dateFormatOption(t,"month","long",o)}),e=JBTools.replaceIfMatched(e,/\%Y/g,function(){return JBTools.dateFormatOption(t,"year","numeric",o)}),e=JBTools.replaceIfMatched(e,/\%y/g,function(){return JBTools.dateFormatOption(t,"year","2-digit",o)}),e=JBTools.replaceIfMatched(e,/\%h/g,function(){return JBTools.dateFormatOption(t,"hour","numeric",o)}),e=JBTools.replaceIfMatched(e,/\%H/g,function(){return JBTools.dateFormatOption(t,"hour","2-digit",o)}),e=JBTools.replaceIfMatched(e,/\%i/g,function(){return JBTools.dateFormatOption(t,"minute","2-digit",o)}),e=JBTools.replaceIfMatched(e,/\%s/g,function(){return JBTools.dateFormatOption(t,"second","2-digit",o)}),e=JBTools.replaceIfMatched(e,/\%a/g,function(){return JBTools.dateFormatOption(t,"hour12","lower",o)}),e=JBTools.replaceIfMatched(e,/\%A/g,function(){return JBTools.dateFormatOption(t,"hour12","upper",o)}),e=JBTools.replaceIfMatched(e,/\%t/g,function(){return JBTools.dateFormatOption(t,"timeZoneName","short",o)}),e=JBTools.replaceIfMatched(e,/\%T/g,function(){return JBTools.dateFormatOption(t,"timeZoneName","long",o)})},Date.prototype.JBFormat=function(t,e){return JBTools.dateFormat(this,t,e)};var JBCalendar=function(t,e){var o=JBTools.initialize(this,e);return o.today=new Date,o.container=null,o.domElement=null,o.date=o.options.date&&"object"==typeof o.options.date?new Date(o.options.date):new Date,o.options.startsOnMonday=!1===o.options.startsOnMonday?0:1,o.options.lang=o.options.lang||"es-ES",t?o.container="string"==typeof t?document.querySelector(t):t:(o.container=document.createElement("div"),o.container.setAttribute("class","datepicker-calendar")),o.container.setAttribute("tabindex","-1"),o.setDate(o.date,o.options.selected||[]),o};JBCalendar.prototype.setDate=function(t,e){var o=this;o.date=new Date(t),o.container.innerHTML="";var n="",a=t.getMonth(),r=1;n+='<tr class="calendar-header">',n+='<th class="control control-left"><span>'+o.JBEvent("controlLeft",[o,a,new Date(t)],function(t,e,o){return e=e<1?11:e-1,(o=new Date(o)).setDate(1),o.setMonth(e),'<button month="'+e+'" type="button">'+o.JBFormat("%M")+"</button>"})+"</span></th>",n+='<th colspan="5"><span>'+o.JBEvent("monthLabel",[o,a,new Date(t)],function(t,e,o){return o.JBFormat("%F",t.options.lang)})+"</span></th>",n+='<th class="control control-right"><span>'+o.JBEvent("controlRight",[o,a,new Date(t)],function(t,e,o){return e=e>10?0:e+1,(o=new Date(o)).setDate(1),o.setMonth(e),'<button month="'+e+'" type="button">'+o.JBFormat("%M")+"</button>"})+"</span></th>",n+="</tr>";var s=[];n+='<tr class="calendar-weekdays">';for(var i=0;i<7;i++){(c=i+o.options.startsOnMonday)>6&&(c-=7),s.push(c);var l=o.JBEvent("dayLabel",[o,c,new Date(t)],function(t,e,o){var n=o.getDay();return(o=new Date(o)).setDate(o.getDate()+(e-n)),o.JBFormat("%l",t.options.lang)});n+='<th title="'+l+'"><span>'+l+"</span></th>"}for(n+="</tr>",t.setDate(r);a==t.getMonth();){n+='<tr class="week">';for(var c=0;c<7;c++)if(s[c]==t.getDay()&&a==t.getMonth()){var d='day="'+r+'" month="'+t.getMonth()+'" year="'+t.getFullYear()+'"><span>'+o.JBEvent("dateLabel",[o,r,new Date(t)],function(t,e,o){return e})+"</span></td>",u=t.JBFormat("%Y-%m-%d")==o.today.JBFormat("%Y-%m-%d")?"day today":"day";JBTools.each(e,function(e,o){t.JBFormat("%Y-%m-%d")==e.JBFormat("%Y-%m-%d")&&(u+=" selected")}),n+='<td class="'+u+'" '+d,r++,t.setDate(r)}else{var p=s.indexOf(t.getDay()),m=new Date(t),h=0;h=1==r?c-p+r:c-p+1,m.setDate(h),n+='<td class="empty"><span>'+o.JBEvent("emptyLabel",[o,m.getDate(),new Date(m)],function(t,e,o){return"&nbsp;"})+"</span></td>"}n+="</tr>"}o.domElement=JBTools.insert(JBTools.create('<table class="jb-calendar">'+n+"</table>"),o.container),o.container&&(JBTools.each(o.domElement.querySelectorAll("td.day"),function(t,e){o.dayEvent(o,t,e)}),JBTools.each(o.domElement.querySelectorAll("th.control"),function(t,e){o.controlEvent(o,t,e)}))},JBCalendar.prototype.dayEvent=function(t,e,o){var n=t.options.selectionClass||"selected";e.addEventListener("click",function(){JBTools.hasClass(e,n)?(JBTools.removeClass(e,n),t.JBEvent("dayDeselected",[t,e.getAttribute("day"),new Date(t.date)],function(t,e,o){o.setDate(e)})):(JBTools.addClass(e,n),t.JBEvent("daySelected",[t,e.getAttribute("day"),new Date(t.date)],function(t,e,o){o.setDate(e)}))},!1)},JBCalendar.prototype.controlEvent=function(t,e,o){e.addEventListener("click",function(){t.JBEvent("controlPressed",[t,e,new Date(t.date)],function(e,o,n){if(o=o.querySelector("[month]")){var a=parseInt(o.getAttribute("month")),r=e.date.getFullYear();e.date.getMonth()>10&&0==a?r+=1:e.date.getMonth()<1&&11==a&&(r-=1),e.date.setFullYear(r,a,1),e.setDate(e.date,t.options.selected||[])}})},!1)};var JBClock=function(t,e){var o=JBTools.initialize(this,e);return o.today=new Date,o.container=null,o.domElement=null,o.date=o.options.date&&"object"==typeof o.options.date?new Date(o.options.date):new Date,o.options.hour12=!0===o.options.hour12,o.options.seconds=!0===o.options.seconds,o.options.lang=o.options.lang||"es-ES",t?o.container="string"==typeof t?document.querySelector(t):t:(o.container=document.createElement("div"),o.container.setAttribute("class","datepicker-clock")),o.container.setAttribute("tabindex","-1"),o.setDate(o.date),o};JBClock.prototype.setDate=function(t){var e=this;e.date=new Date(t),e.container.innerHTML="";var o="";o+='<tr class="clock-header">',o+='<th colspan="7">'+e.JBEvent("dateLabel",[e,t],function(t,e){return e.JBFormat("%d de %F, %Y",t.options.lang)})+"</th>",o+="</tr>",o+='<tr class="clock-rows">',e.options.seconds?(o+="<td></td>",o+='<td class="hours"><input size="2" value="'+e.date.JBFormat("%H")+'"></td>',o+="<td>:</td>",o+='<td class="minutes"><input size="2" value="'+e.date.JBFormat("%i")+'"></td>',o+="<td>:</td>",o+='<td class="seconds"><input size="2" value="'+e.date.JBFormat("%s")+'"></td>',o+="<td></td>"):(o+='<td colspan="2"></td>',o+='<td class="hours"><input size="2" value="'+e.date.JBFormat("%H")+'"></td>',o+="<td>:</td>",o+='<td class="minutes"><input size="2" value="'+e.date.JBFormat("%i")+'"></td>',o+='<td colspan="2"></td>'),o+="</tr>",o+='<tr class="clock-rows">',o+='<td colspan="7"><button type="button">'+e.JBEvent("setButton",[e,t],function(){return"OK"})+"</button></td>",o+="</tr>",e.domElement=JBTools.insert(JBTools.create('<table class="jb-clock">'+o+"</table>"),e.container),e.container&&(JBTools.each(e.domElement.querySelectorAll("input"),function(t,o){e.doubleDigits(t,0==o?23:59)}),JBTools.each(e.domElement.querySelectorAll("button"),function(t,o){e.buttonPressed(e,t)}))},JBClock.prototype.doubleDigits=function(t,e){t.addEventListener("focus",function(){this.select?this.select():this.setSelectionRange&&this.setSelectionRange(0,this.value.length)},!1),t.addEventListener("change",function(){this.value=parseInt(this.value)||0,this.value=this.value<0?0:this.value,this.value=this.value>e?e:this.value,this.value=("0"+this.value).slice(-2)},!1)},JBClock.prototype.buttonPressed=function(t,e){e.addEventListener("click",function(){var e=t.domElement.querySelector(".hours input"),o=t.domElement.querySelector(".minutes input"),n=t.domElement.querySelector(".seconds input");if(e&&o){var a=new Date(t.date);a.setHours(e.value),a.setMinutes(o.value),a.setSeconds(n?n.value:0),t.JBEvent("timeChanged",[t,a],function(t,e){console.log(e.JBFormat("%H:%i:%s %a",t.options.lang))})}},!1)};var JBDatePicker=function(t,e){var o=JBTools.initialize(this,e);o.container=null,o.input=t,o.type=!1===o.options.time?"date":"datetime";var n=o.input&&""!=o.input.value?Date.parse(o.input.value):0;return o.date=n>0?new Date(n):new Date,o.date=o.options.date&&"object"==typeof o.options.date?new Date(o.options.date):o.date,o.options.container?"string"==typeof o.options.container?o.container=document.querySelector(o.options.container):o.container=o.options.container:(o.container=document.createElement("div"),o.container.setAttribute("class","datepicker-container")),o.container.setAttribute("tabindex","-1"),o.options.events=o.events,o.options.date=o.date,o.options.selected=[o.options.date],!1!==o.options.hidden&&(o.close=document.createElement("button"),o.close.setAttribute("class","datepicker-close"),o.close.setAttribute("type","button"),o.close.innerHTML=o.JBEvent("closeLabel",[],function(){return"x"}),o.close.addEventListener("click",function(){JBTools.remove(o.container)},!1),JBTools.insert(o.close,o.container)),o.options.events.daySelected=function(t,e,n){t.date.setDate(e),JBTools.each(t.container.querySelectorAll(".day.selected"),function(t,o){t.getAttribute("day")!=e&&JBTools.removeClass(t,"selected")}),"datetime"==o.type?o.clock.setDate(t.date):(o.setInputDate(t.date.JBFormat(o.options.format,t.options.lang)),!1!==o.options.hidden&&JBTools.remove(o.container))},o.calendar=new JBCalendar(null,o.options),JBTools.insert(o.calendar.container,o.container),"datetime"==o.type&&(o.options.events.timeChanged=function(t,e){o.calendar.date=new Date(e),o.setInputDate(e.JBFormat(o.options.format,t.options.lang)),!1!==o.options.hidden&&JBTools.remove(o.container)},o.clock=new JBClock(null,o.options),JBTools.insert(o.clock.container,o.container)),!1===o.options.hidden?o.alwaysFocus():o.stepsFocus(),o};JBDatePicker.prototype.setInputDate=function(t){this.input&&(this.input.value=t)},JBDatePicker.prototype.stepsFocus=function(){var t=this,e=null,o=function(t){t&&t.stopPropagation(),clearTimeout(e)};t.input.addEventListener("focus",function(e){o(e),JBTools.insert(t.container,t.input.parentNode)},!0),t.input.addEventListener("blur",function(o){e=setTimeout(function(){JBTools.remove(t.container)},10)},!0),t.container.addEventListener("focus",o,!1),t.container.addEventListener("click",o,!1),JBTools.each(t.container.querySelectorAll("button"),function(t,e){t.addEventListener("focus",o,!1)})},JBDatePicker.prototype.alwaysFocus=function(){var t=this;JBTools.insert(t.container,t.input.parentNode)};